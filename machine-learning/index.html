<html>
<head>
</head>
<body>
<div>
    <p>
        <label for="input">Sy√∂te</label>
        <input type="text"  size="100" maxlength="150" id="input">
        <span id="output" />
    </p>
</div>

</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/bacon.js/0.7.0/Bacon.min.js"></script>
<script type='text/javascript'>
    function dec65(val) {
        return val - 65;
    }

    var transitions = [[0.5, 0.5],
                       [0.5, 0.5]];
    var states = 2;

    function obFn(observation, j) {
        return 0.3;
    }

    function viterbi(accumulator, observation) {
        console.log(observation, + "+++" + accumulator);
        var newPath = [];
        for (var j = 0; j < states; j = j + 1) {
            var highestProbability = -1, survivorState = -1;
            for (var i = 0; i < states ; i = i + 1) {
                var probability = accumulator.viterbi[i] * transitions[i][j] * obFn(observation, j);
                if (probability > highestProbability) {
                    survivorState = i;
                    highestProbability = probability;
                }
            }
            accumulator.viterbi[j] = highestProbability;
            newPath[j] = accumulator.path[survivorState].slice();
            newPath[j].push(j);
        }
        return {path: newPath, viterbi: accumulator.viterbi};
    }


    $(document).ready(function() {
        var keyPresses = $('#input')
                .asEventStream('keyup')
                .map('.keyCode')
                .map(dec65)
                .scan({path: [[0], [1]], viterbi: [0.3, 0.3]}, viterbi);
        keyPresses.log();
    });


</script>
</html>

