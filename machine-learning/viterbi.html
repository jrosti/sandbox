<html>
<head>
</head>
<body>
<div>
    <div style="display: none" id="interpretor">
        <p>
            <label for="input">Sy√∂te</label>
            <input type="text"  size="100" maxlength="150" id="input"><br/>
           Tulos:  <span id="output" />
        </p>
    </div>
</div>

</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/bacon.js/0.7.0/Bacon.min.js"></script>
<script type='text/javascript'>

    function createViterbi(states, transitions, observationFunction, initialProbabilities) {

        return function viterbi(accumulator, observation) {
            if (accumulator.path.length < 1) {
                var path = [], viterbi = [];
                for (var state = 0; state < states; state = state + 1) {
                    path.push([state]);

                    viterbi.push(initialProbabilities * observationFunction(observation, state));
                }
                return {path: path, viterbi: viterbi};
            }
            var newPath = [], newViterbi = [];
            for (var j = 0; j < states; j = j + 1) { // loop over next state
                var survivor = { index: -1, probability: -1 };
                for (var i = 0; i < states ; i = i + 1) { // loop over source state
                    var probability = accumulator.viterbi[i] * transitions[i][j] * observationFunction(observation, j);
                    if (probability > survivor.probability) {
                        survivor.index = i;
                        survivor.probability = probability;
                    }
                }
                newViterbi[j] = survivor.probability;
                newPath[j] = accumulator.path[survivor.index].slice();
                newPath[j].push(j);
            }
            return {path: newPath, viterbi: newViterbi};
        }
    }

    function conclude(viterbiAccumulator) {
        var best = { index: -1, probability: -1 };
        $.each(viterbiAccumulator.viterbi, function(state, probability) {
            if (probability > best.probability) {
                best.index = state;
                best.probability = probability;
            }
        });
        var result = '';
        $.each(viterbiAccumulator.path[best.index], function(_, val) {
            result = result + String.fromCharCode(val + 65);
        })
        return result;
    }

    $(document).ready(function() {
        var states = transitions.length,
            initialProbabilities = 1.0 / states;

        var observationFunction = function(observation, state) {
            var smoothing = 0.2;
            if (observation === state) {
                return 1.0 - smoothing;
            } else {
                return smoothing / (states - 1);
            }
        }
        var keyCodeToState = function(val) {
            var aAsZero = val - 65;
            return aAsZero;
        }

        var viterbi = createViterbi(states, transitions, observationFunction, initialProbabilities);

        var viterbiAccumulator = $('#input')
                .asEventStream('keyup')
                .map('.keyCode')
                .map(keyCodeToState)
                .filter(function(x) { return x >= 0 && x < 26})
                .scan({path: []}, viterbi);

        viterbiAccumulator.log();

        viterbiAccumulator
                .filter(function(x) {return x.viterbi})
                .map(conclude)
                .assign($("#output"), "text");

        $('#interpretor').show();

    });

    // Transitionprobabilities trained by the words in dict.
    var transitions = [ [ 0.000041564191792494054,
        0.004705504028718669,
        0.005802033035875913,
        0.0029559796926109257,
        0.0007487023495253205,
        0.000696747109784703,
        0.0027065945418559617,
        0.0002904024452870308,
        0.0018703886306622325,
        0.0000749249246785748,
        0.0009494136441022326,
        0.014080963764228216,
        0.003489751418788218,
        0.012237373099326933,
        0.00010883255482508311,
        0.003577801877717054,
        0.00008476907536627076,
        0.010227525667255676,
        0.0048367593712212815,
        0.014033383702571019,
        0.001635769705938812,
        0.0009986343975407124,
        0.000558382102896532,
        0.0004397053973837529,
        0.0007180761029413775,
        0.0004331426302586222 ],
        [ 0.002414551404787648,
            0.0004654095686238479,
            0.00011320773290850354,
            0.00015422502744057005,
            0.0026874531377409972,
            0.000039923500011211394,
            0.000024063479458812347,
            0.000051408342480190014,
            0.0027902698227013772,
            0.00008969115071011875,
            0.000007109664385558194,
            0.004739958556125605,
            0.00008039389728285034,
            0.0000410172945320665,
            0.0020185977882380994,
            0.00006508077399087884,
            0.000003828280822992874,
            0.0019316411238301185,
            0.0004276736576543467,
            0.0001618815890865558,
            0.0013814624798399997,
            0.00004539247261548693,
            0.000025157273979667455,
            5.468972604275533e-7,
            0.00018594506854536814,
            0.000002734486302137767 ],
        [ 0.007322407419864512,
            0.000004375178083420427,
            0.0007497961440461757,
            0.000012578636989833727,
            0.004883792535618051,
            0.0000021875890417102134,
            0.00000164069178128266,
            0.006232988077092825,
            0.003567957727029358,
            5.468972604275533e-7,
            0.0019305473293092634,
            0.0016395979867618049,
            0.000016953815073254155,
            0.0000749249246785748,
            0.008106658091317623,
            0.000007109664385558194,
            0.000051408342480190014,
            0.002811598815858052,
            0.0002543072260988123,
            0.0035756142886753436,
            0.0025605729733218048,
            5.468972604275533e-7,
            0.000006015869864703087,
            5.468972604275533e-7,
            0.0013820093771004273,
            0.000013672431510688833 ],
        [ 0.002113211014292066,
            0.00009461322605396673,
            0.00005523662330318289,
            0.0005200992946666032,
            0.006900749632074868,
            0.00011539532195021375,
            0.0003084500548811401,
            0.00013672431510688832,
            0.0060306360907346306,
            0.00007765941098071258,
            0.000014219328771116387,
            0.0011457497605957241,
            0.0002050864726603325,
            0.0005698669453655106,
            0.0026136220075832772,
            0.000049767650698907354,
            0.000003828280822992874,
            0.0016762401032104509,
            0.0002920431370683135,
            0.00003882970549035629,
            0.0010232447742599524,
            0.0001230518835961995,
            0.00014820915757586696,
            5.468972604275533e-7,
            0.0006666677604611875,
            0.000007656561645985747 ],
        [ 0.004531043802642279,
            0.000948866746841805,
            0.004315566282033823,
            0.007846334995354108,
            0.002093522712916674,
            0.0012299719387015675,
            0.0012595043907646553,
            0.0004758006165719714,
            0.0012600512880250828,
            0.0001159422192106413,
            0.0001761009178576722,
            0.00610227963185064,
            0.004102823247727505,
            0.012793020715921328,
            0.0020853192540102607,
            0.0029598079734339186,
            0.00031118454118327787,
            0.021600801095107074,
            0.010350030653591446,
            0.006121967933226032,
            0.0014131825209447977,
            0.0010123068290514012,
            0.000764015472817292,
            0.0017391332881596196,
            0.0004227515823104987,
            0.00010883255482508311 ],
        [ 0.0011036386715428026,
            0.00001312553425026128,
            0.000006015869864703087,
            0.0000082034589064133,
            0.001678427692252161,
            0.0009193342947787171,
            0.00000492207534384798,
            0.000015313123291971495,
            0.002118133089635914,
            0.0000021875890417102134,
            0.00000328138356256532,
            0.0013048968633801422,
            0.00001148484246897862,
            0.000013672431510688833,
            0.0019403914799969594,
            0.00000656276712513064,
            5.468972604275533e-7,
            0.0008334714248915913,
            0.000023516582198384795,
            0.00043751780834204267,
            0.0014006038839549642,
            0.0000010937945208551067,
            0.000016953815073254155,
            5.468972604275533e-7,
            0.00030024659597472676,
            0.00000164069178128266 ],
        [ 0.0023122816170876954,
            0.00005414282878232778,
            0.000008750356166840854,
            0.00003718901370907363,
            0.003981958953173016,
            0.00003554832192779097,
            0.0005977587056473159,
            0.0008837859728509262,
            0.0027158917952832297,
            0.0000021875890417102134,
            0.000007109664385558194,
            0.002107195144427363,
            0.0003046217740581472,
            0.0009570702057482183,
            0.0015127178223426126,
            0.000020235198635819475,
            5.468972604275533e-7,
            0.0024369741924651776,
            0.00015039674661757716,
            0.00005687731508446555,
            0.0011561408085438477,
            0.00000164069178128266,
            0.00006672146577216151,
            5.468972604275533e-7,
            0.0008465969591418526,
            0.00000492207534384798 ],
        [ 0.004215484083375581,
            0.00009516012331439428,
            0.00003718901370907363,
            0.000043204883573776714,
            0.00607110648800627,
            0.00010828565756465556,
            0.000020235198635819475,
            0.00003882970549035629,
            0.004813242789022897,
            0.000002734486302137767,
            0.000012031739729406173,
            0.0006513546371692161,
            0.0002778238082971971,
            0.0003576708083196199,
            0.005082863138413681,
            0.00006179939042831352,
            0.000002734486302137767,
            0.0015017798771340615,
            0.00008148769180370544,
            0.0008400341920167219,
            0.0007716720344632778,
            0.000007109664385558194,
            0.00014875605483629452,
            5.468972604275533e-7,
            0.0032059117406263177,
            0.000002734486302137767 ],
        [ 0.006090247892121234,
            0.0015690482401666504,
            0.013416483592808738,
            0.004456118877963705,
            0.00199836258960228,
            0.0022537636102219474,
            0.0022887650348893105,
            0.00014109949319030877,
            0.0000749249246785748,
            0.000030079349323515434,
            0.0009691019454776246,
            0.005156147371310973,
            0.002612528213062422,
            0.017168198799341755,
            0.007979231029638004,
            0.002523383959612731,
            0.00014602156853415674,
            0.002245560151315534,
            0.011727117955348027,
            0.008533237954451114,
            0.000712607130337102,
            0.002793004309003515,
            0.00003609521918821852,
            0.00022532167129615197,
            0.000015860020552399047,
            0.002258138788305368 ],
        [ 0.0003128252329645605,
            0.0000010937945208551067,
            5.468972604275533e-7,
            0.00000164069178128266,
            0.00027016724665121137,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.00000328138356256532,
            0.00008531597262669832,
            0.0000010937945208551067,
            0.0000010937945208551067,
            0.0000010937945208551067,
            0.00000164069178128266,
            0.00000164069178128266,
            0.0002614168904843705,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.000004375178083420427,
            5.468972604275533e-7,
            0.0000010937945208551067,
            0.0004216577877896436,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.000002734486302137767,
            5.468972604275533e-7 ],
        [ 0.0005824455823553443,
            0.00007765941098071258,
            0.000018594506854536815,
            0.000018594506854536815,
            0.002562760562363515,
            0.0000656276712513064,
            0.00000984415068769596,
            0.0001148484246897862,
            0.0012277843496598573,
            0.000008750356166840854,
            0.000028438657542232774,
            0.00039650051380997616,
            0.00008422217810584322,
            0.00024172858910897859,
            0.00022313408225444175,
            0.00003390763014650831,
            5.468972604275533e-7,
            0.00009406632879353918,
            0.00020782095896247028,
            0.00006836215755344416,
            0.0001148484246897862,
            0.00000328138356256532,
            0.0001044573767416627,
            5.468972604275533e-7,
            0.00022313408225444175,
            5.468972604275533e-7 ],
        [ 0.008042124214587172,
            0.00022586856855657953,
            0.0003959536165495486,
            0.0006923719317012825,
            0.01194970514034204,
            0.0002750893219950593,
            0.00028329278090147265,
            0.00007437802741814726,
            0.010202915290536435,
            0.00000164069178128266,
            0.00025266653431752964,
            0.0056199162481535385,
            0.00046978474670726834,
            0.0003948598220286935,
            0.006447918700440854,
            0.000527755856312589,
            0.000004375178083420427,
            0.00005851800686574821,
            0.00032868525351695954,
            0.0011862201578673633,
            0.002123055164979762,
            0.0003729839316115914,
            0.00011211393838764843,
            0.0000021875890417102134,
            0.00743233376921045,
            0.00000984415068769596 ],
        [ 0.006428230399065462,
            0.0013027092743384322,
            0.00002789176028180522,
            0.0000246103767192399,
            0.006165172816799809,
            0.00007711251372028502,
            0.000010391047948123513,
            0.00002625106850052256,
            0.005636323165966365,
            0.000003828280822992874,
            0.0000082034589064133,
            0.000138365006888171,
            0.0010401985893332064,
            0.00034399837680893104,
            0.004267439323116198,
            0.0022783739869411874,
            0.00000164069178128266,
            0.000028438657542232774,
            0.000138365006888171,
            0.00002132899315667458,
            0.0012152057126700235,
            0.0000246103767192399,
            0.000033360732886080754,
            5.468972604275533e-7,
            0.001116764205793064,
            0.0000021875890417102134 ],
        [ 0.005938757350982802,
            0.0005058799658954868,
            0.004520652754694156,
            0.004845509727388122,
            0.011125530968877717,
            0.0011566877058042753,
            0.006809964686843894,
            0.0004719723357489785,
            0.006733399070384036,
            0.00017063194525339663,
            0.0006825277810135865,
            0.0006431511782628027,
            0.0005332248289168645,
            0.0011457497605957241,
            0.006072747179787552,
            0.0008088610481723514,
            0.0001761009178576722,
            0.0007038567741702612,
            0.0034120920078075053,
            0.010252136043974914,
            0.001018869596176532,
            0.0005523662330318288,
            0.00037353082887201894,
            0.000036642116448646074,
            0.0006551829179922089,
            0.00019305473293092633 ],
        [ 0.0012179401989721613,
            0.0015553758086559618,
            0.003870391912045795,
            0.0026070592404581466,
            0.0008405810892771494,
            0.0007864382604948217,
            0.003961723754537196,
            0.0003598583973613301,
            0.0020257074526236576,
            0.000046486267136342034,
            0.0005293965480938716,
            0.006203455625029737,
            0.006154781768851685,
            0.01486904271650432,
            0.0024730694116533963,
            0.005459675350848265,
            0.00011211393838764843,
            0.009890636954832301,
            0.005363421433013015,
            0.004400335357400094,
            0.006980596632097291,
            0.0019775804937060327,
            0.0013672431510688833,
            0.0006907312399199999,
            0.00029915280145387165,
            0.00022696236307743464 ],
        [ 0.004189779912135486,
            0.00006945595207429927,
            0.000041564191792494054,
            0.000017500712333681707,
            0.005729295700239049,
            0.00005250213700104512,
            0.000021875890417102135,
            0.00631228817985482,
            0.0033382608776497858,
            0.000007109664385558194,
            0.00002132899315667458,
            0.0025600260760613772,
            0.00007437802741814726,
            0.00020016439731648453,
            0.004362599446430593,
            0.0010303544386455106,
            0.0000010937945208551067,
            0.005165991521998669,
            0.0010992634934593821,
            0.001538968890843135,
            0.0012239560688368644,
            0.0000021875890417102134,
            0.00007328423289729215,
            5.468972604275533e-7,
            0.0007355768152750592,
            5.468972604275533e-7 ],
        [ 0.0000010937945208551067,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.00000164069178128266,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.0000010937945208551067,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.0000010937945208551067,
            5.468972604275533e-7,
            0.0000010937945208551067,
            0.0000010937945208551067,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.0018714824251830876,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7 ],
        [ 0.011651099236148597,
            0.000977305404384038,
            0.0019179686923194296,
            0.001840309281338717,
            0.012552932818593631,
            0.0005124427330206175,
            0.000989337144113444,
            0.000743233376921045,
            0.010947789359238763,
            0.0000574242123448931,
            0.000593930424824323,
            0.0009707426372589071,
            0.0024161920965689305,
            0.0013541176168186222,
            0.011280849790839143,
            0.0012064553565031826,
            0.00004375178083420427,
            0.001874763808745653,
            0.0019092183361525887,
            0.002861366466556959,
            0.0018069485484526362,
            0.0005589290001569595,
            0.0003423576850276484,
            0.0000021875890417102134,
            0.003060983966613016,
            0.00002789176028180522 ],
        [ 0.0026710462199281706,
            0.00013016154798175768,
            0.003233803500908123,
            0.00007054974659515438,
            0.005880239344117053,
            0.00014930295209672207,
            0.00007765941098071258,
            0.0036735088982918756,
            0.005957898755097766,
            0.000021875890417102135,
            0.0005025985823329215,
            0.0011862201578673633,
            0.002577526788395059,
            0.0008378466029750117,
            0.002993715603580427,
            0.0028914458158804746,
            0.00033360732886080754,
            0.00008039389728285034,
            0.007577808440484179,
            0.011053887427761708,
            0.00343560859000589,
            0.00003718901370907363,
            0.00042220468505007117,
            5.468972604275533e-7,
            0.0010757469112609975,
            0.00000492207534384798 ],
        [ 0.006931922775919239,
            0.00015203743839885983,
            0.000553460027552684,
            0.00004703316439676959,
            0.01503912776449729,
            0.00025376032883838475,
            0.00006726836303258906,
            0.005790548193406935,
            0.016121984340143846,
            0.000016953815073254155,
            0.0000164069178128266,
            0.001182938774304798,
            0.00030516867131857476,
            0.00024883825349453675,
            0.007612809865151542,
            0.00012031739729406174,
            0.000005468972604275534,
            0.007237638344498241,
            0.00037462462339287405,
            0.0016193627881259855,
            0.0023352513020256527,
            0.000021875890417102135,
            0.00039212533572655577,
            0.0000010937945208551067,
            0.002910587219995439,
            0.0000492207534384798 ],
        [ 0.0013245851647555342,
            0.0017156167059612349,
            0.0014027914729966744,
            0.0011703601373149642,
            0.0009740240208214725,
            0.00029259003432874104,
            0.0006940126234825652,
            0.00002132899315667458,
            0.0013010685825571495,
            0.00001476622603154394,
            0.0001148484246897862,
            0.004961451946598764,
            0.002817614685722755,
            0.010276199523433727,
            0.00035438942475705455,
            0.001636863500459667,
            0.000006015869864703087,
            0.0043571304738263174,
            0.006971299378670023,
            0.0028181615829831826,
            0.000012578636989833727,
            0.00012359878085662704,
            0.000007656561645985747,
            0.00011758291099192397,
            0.000033360732886080754,
            0.00006617456851173395 ],
        [ 0.0015646730620832302,
            5.468972604275533e-7,
            0.0000010937945208551067,
            5.468972604275533e-7,
            0.005694294275571685,
            5.468972604275533e-7,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.002073834411541282,
            5.468972604275533e-7,
            0.00000164069178128266,
            0.000002734486302137767,
            5.468972604275533e-7,
            0.000002734486302137767,
            0.0007902665413178145,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.000017500712333681707,
            0.0000021875890417102134,
            5.468972604275533e-7,
            0.0001405525959298812,
            0.00000656276712513064,
            5.468972604275533e-7,
            5.468972604275533e-7,
            0.00004211108905292161,
            0.00000164069178128266 ],
        [ 0.0015105302333009024,
            0.00007054974659515438,
            0.0000164069178128266,
            0.00007601871919942991,
            0.001081215883865273,
            0.000043204883573776714,
            0.000015313123291971495,
            0.00048783235630137756,
            0.0011774698017005224,
            0.0000010937945208551067,
            0.000051408342480190014,
            0.0001968830137539192,
            0.000046486267136342034,
            0.00029477762337045126,
            0.0011577815003251304,
            0.00002625106850052256,
            0.00000164069178128266,
            0.0002286030548587173,
            0.00011320773290850354,
            0.00004211108905292161,
            0.0000328138356256532,
            5.468972604275533e-7,
            0.00003117314384437054,
            5.468972604275533e-7,
            0.00005359593152190023,
            0.00000656276712513064 ],
        [ 0.00037899980147629444,
            0.000013672431510688833,
            0.00021055544526460803,
            0.000006015869864703087,
            0.0002674327603490736,
            0.00001476622603154394,
            0.000004375178083420427,
            0.00006179939042831352,
            0.0007219043837643704,
            5.468972604275533e-7,
            0.0000010937945208551067,
            0.000022422787677529687,
            0.000012031739729406173,
            0.000005468972604275534,
            0.00026305758226565315,
            0.00030134039049558187,
            0.000006015869864703087,
            0.000004375178083420427,
            0.00003062624658394299,
            0.0004172826097062232,
            0.00008476907536627076,
            0.0000010937945208551067,
            0.00001312553425026128,
            5.468972604275533e-7,
            0.0002953245206308788,
            0.0000010937945208551067 ],
        [ 0.000584086274136627,
            0.0001361774178464608,
            0.000759093397473444,
            0.0005458034659066982,
            0.0004861916645200949,
            0.00007219043837643704,
            0.0003423576850276484,
            0.00008586286988712587,
            0.00029259003432874104,
            0.00000164069178128266,
            0.000022422787677529687,
            0.0014487308428725889,
            0.000876676308465368,
            0.0008121424317349167,
            0.0005851800686574821,
            0.001318569294890831,
            0.000002734486302137767,
            0.0006994815960868408,
            0.0011479373496374344,
            0.0007886258495365319,
            0.000033360732886080754,
            0.000008750356166840854,
            0.00010773876030422801,
            0.00006234628768874108,
            0.0000021875890417102134,
            0.0000574242123448931 ],
        [ 0.0007804223906301187,
            0.000004375178083420427,
            0.00000164069178128266,
            0.00000328138356256532,
            0.0017626498703580044,
            0.00000164069178128266,
            0.000003828280822992874,
            0.0000021875890417102134,
            0.0003199348973501187,
            5.468972604275533e-7,
            0.0000021875890417102134,
            0.00006890905481387172,
            0.00000164069178128266,
            0.00000164069178128266,
            0.0006584643015547742,
            0.0000010937945208551067,
            5.468972604275533e-7,
            0.0000010937945208551067,
            0.0000010937945208551067,
            0.000004375178083420427,
            0.000028438657542232774,
            0.0000010937945208551067,
            0.000003828280822992874,
            5.468972604275533e-7,
            0.00016242848634698335,
            0.0001405525959298812 ] ];

</script>
</html>

